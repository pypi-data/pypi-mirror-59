(function(b){function a(g,d){d=b.extend({},b.fn.djangoInline.defaults,d);this.group=g;this.$group=b(g);this.options=d;d.prefix=d.prefix||this.$group.attr("id").replace(/-group$/,"");if(d.formTemplate){this.$form_template=b(d.formTemplate)}else{this.$form_template=this.$group.children(".js-django-inlines-forms").children(this.options.emptyFormSelector);var f=b("input,textarea,select").filter("[required]:hidden");f.prop("required",false);f.addClass("required")}if(d.showAddButton!==false){this.$addButton=this.$group.find(".js-django-inlines-add-form-"+d.prefix);if(!this.$addButton.length){this.$addButton=this.createAddButton()}else{this.$addButton.filter("a, button").click(b.proxy(this._onAddButtonClick,this));this.$addButton.find("a, button").click(b.proxy(this._onAddButtonClick,this))}this._toggleAddButtonDisplay()}var e=this;this.$group.on("click",".js-django-inlines-remove-form",function(h){h.preventDefault();e.removeForm(this)})}a.prototype={createAddButton:function(){var d;var e=this;if(this.options.childTypes){d=b(this._renderPolymorphicAddButton());this.$group.after(d);d.children("a").click(b.proxy(this._onMenuToggle,this));d.find("li a").click(b.proxy(this._onAddButtonClick,this))}else{d=b(this._renderAddButton());this.$group.after(d);d.find("a").click(b.proxy(this._onAddButtonClick,this))}return d},_renderAddButton:function(){return""},_renderPolymorphicAddButton:function(){var f='<div class="add-form-choice-menu" style="display: none;"><ul>';for(var d=0;d<this.options.childTypes.length;d++){var e=this.options.childTypes[d];f+='<li><a href="#" data-type="'+e.type+'">'+e.name+"</a></li>"}f+="</ul></div>";return'<div class="'+this.options.addCssClass+' add-form-choice"><a href="#">'+this.options.addText+"</a>"+f+"</div>"},_onMenuToggle:function(f){f.preventDefault();f.stopPropagation();var e=b(f.target).next(".add-form-choice-menu");if(!e.is(":visible")){function d(){e.slideUp();b(document).unbind("click",d)}b(document).click(d)}e.slideToggle()},_onAddButtonClick:function(f){f.preventDefault();var e=b(f.target).attr("data-type");var d=!e?null:this.options.emptyFormSelector+"[data-inline-type="+e+"]";this.addForm(d)},_toggleAddButtonDisplay:function(){var e=this._getManagementForm();var d=(e.max_forms&&e.max_forms.value&&parseInt(e.total_forms.value)>=parseInt(e.max_forms.value));this.$addButton.toggle(!d)},addForm:function(h){var j;if(h){if(this.$form_template&&this.$form_template.length>0){j=this.$form_template.filter(h)}else{j=this.$group.find(h)}if(j.length===0){throw new Error("Form template '"+h+"' not found")}}else{if(!this.$form_template||this.$form_template.length===0){throw new Error("No empty form available. Define the 'form_template' setting or add an '.empty-form' element in the '"+this.options.prefix+"' formset group!")}j=this.$form_template}j.find(".select2").remove();var i=this._getManagementForm();if(!i.total_forms){throw new Error("Missing '#"+this._getGroupFieldIdPrefix()+"-TOTAL_FORMS' field. Make sure the management form included!")}var e;if(this.options.newFormTarget==null){e=j.parent()}else{if(b.isFunction(this.options.newFormTarget)){e=this.options.newFormTarget.apply(this.group)}else{e=this.$group.find(this.options.newFormTarget)}}if(e===null||e.length===0){throw new Error("No container found via custom 'newFormTarget' function!")}var d=parseInt(i.total_forms.value);var f=this._getFormId(d);var k=j.clone();k.find('[id*="__prefix__"],[name*="__prefix__"],[for*="__prefix__"],[class*="__prefix__"]').each(function(){function l(p,n){var o=p.attr(n);if((o!==undefined)&&o.includes("__prefix__")){o=o.replace(/__prefix__/,d);p.attr(n,o)}}var m=b(this);l(m,"id");l(m,"name");l(m,"for");if((m[0].tagName==="DIV")&&this.classList.contains("js-django-inlines")){l(m,"data-options")}if((m[0].tagName==="A")&&this.className.match(/__prefix__/)){l(m,"class")}});k=k.removeClass("empty-form").attr("id",f);k.find('.empty-form:not([id*="__prefix__"])').removeClass("empty-form");if(d>0){b('div:not([id^="detail-items-"])',k).filter('div:not([id^="detail-template-"])').find(".ftl-inlines-first-only").each(function(l,m){b(m).removeClass("ftl-inlines-first-only").addClass("sr-only")})}e.append(k);var g=b("#"+f);if(g.length===0){throw new Error("New FormSet item not found: #"+f)}g.data("djangoInlineIndex",d);k.find(".required").prop("required",true).removeClass("required");if(this.options.onAdd){this.options.onAdd.call(this.group,g,d,this.options)}i.total_forms.value=d+1;return g},getFormAt:function(d){return b("#"+this._getFormId(d))},_getFormId:function(d){return this.options.itemIdTemplate.replace("{prefix}",this.options.prefix).replace("{index}",d)},_getGroupFieldIdPrefix:function(){return this.options.autoId.replace("{prefix}",this.options.prefix)},_getManagementForm:function(){var d=this._getGroupFieldIdPrefix();return{total_forms:b("#"+d+"-TOTAL_FORMS")[0],initial_forms:b("#"+d+"-INITIAL_NUM_FORMS")[0],min_forms:b("#"+d+"-MIN_NUM_FORMS")[0],max_forms:b("#"+d+"-MAX_NUM_FORMS")[0],group_id_prefix:d}},_getItemData:function(f){var e=b(f).closest(this.options.itemsSelector);if(e.length===0){return null}var g=e.attr("id");var d=(new RegExp("^"+this.options.itemIdTemplate.replace("{prefix}","(.+?)").replace("{index}","(\\d+)")+"$")).exec(g);return{formset_item:e,prefix:d[1],index:parseInt(d[2],0)}},_getItemForm:function(d){var f=this._getItemData(d);if(f===null){return null}var e=this._getGroupFieldIdPrefix()+"-"+f.index;return b.extend({},f,{field_id_prefix:e,field_name_prefix:f.prefix+"-"+f.index,pk_field:b("#"+e+"-"+this.options.pkFieldName),delete_checkbox:b("#"+e+"-DELETE")})},removeForm:function(g){var j=this._getManagementForm();var e=this._getItemForm(g);if(e===null){throw new Error("No form found for the selector '"+g.selector+"'!")}var h=parseInt(j.total_forms.value);var k=e.pk_field.length!==0;if(this.options.onBeforeRemove){this.options.onBeforeRemove.call(this.group,e.formset_item,this.options)}if(k&&e.pk_field[0].value){if(e.delete_checkbox.length){e.delete_checkbox.attr("checked",true)}else{var d='<label class="" for="\' + itemform.field_id_prefix + \'-DELETE"><input type="checkbox" id="'+e.field_id_prefix+'-DELETE" name="'+e.field_name_prefix+'-DELETE" value="on" class="checkboxinput">Apagar</label>';b(d).appendTo(e)}e.formset_item.hide()}else{for(var f=e.index+1;f<h;f++){this._renumberItem(this.getFormAt(f),f-1)}j.total_forms.value--;e.formset_item.remove()}if(this.options.onRemove){this.options.onRemove.call(this.group,e.formset_item,this.options)}return e.formset_item},_renumberItem:function(l,m){var g=new RegExp("("+this._getFormId("(\\d+|__prefix__)")+")");var f=this._getFormId(m);l.data("djangoInlineIndex",m);var d=l.add(l.find("*"));for(var k=0;k<d.length;k++){var h=d[k];var e=b(h);var j=e.attr("for");if(j&&j.match(g)){e.attr("for",j.replace(g,f))}if(h.id&&h.id.match(g)){h.id=h.id.replace(g,f)}if(h.name&&h.name.match(g)){h.name=h.name.replace(g,f)}}},getFormIndex:function(d){var e=this._getItemData(d);return e?e.index:null},getForms:function(){return this.$group.children(this.options.itemsSelector+":not("+this.options.emptyFormSelector+")")},getEmptyForm:function(){return this.$form_template},getFieldIdPrefix:function(d){if(!b.isNumeric(d)){var e=this._getItemData(d);if(e===null){throw new Error("Unexpected element in getFieldIdPrefix, needs to be item_index, or DOM child node.")}d=e.index}return this._getGroupFieldIdPrefix()+"-"+d},getFieldsAt:function(e){var d=this.getFormAt(e);return this.getFields(d)},getFields:function(j){var l=this._getItemData(j);if(l===null){return null}var d={};var h=l.formset_item.find(":input");var g=this.prefix+"-"+l.index;for(var f=0;f<h.length;f++){var e=h[f].name;if(e.substring(0,g.length)==g){var k=e.substring(g.length+1);d[k]=h[f]}}return d},removeFormAt:function(d){return this.removeForm(this.getFormAt(d))}};function c(d){if(d.length){if(d[0].outerHTML){return d[0].outerHTML}else{return b("<div>").append(d.clone()).html()}}return null}b.fn.djangoInline=function(g){var f=Array.prototype.splice.call(arguments,1);var d=(typeof g==="string");var e=(d?undefined:this);this.filter(".inline-group").each(function(){var j=b(this);var i=j.data("djangoInline");if(!i){var h=typeof g==="object"?g:{};j.data("djangoInline",(i=new a(this,h)))}if(typeof g==="string"){e=i[g].apply(i,f)}});return e};b.fn.djangoInline.defaults={pkFieldName:"id",autoId:"id_{prefix}",prefix:null,newFormTarget:null,itemIdTemplate:"{prefix}-{index}",itemsSelector:".inline-related",emptyFormSelector:".empty-form",formTemplate:null,childTypes:null,showAddButton:true,addText:"add another",addCssClass:"add-row"};b.fn.djangoInline.Constructor=a;b.fn.ready(function(){b(".js-django-inlines").each(function(){var e=b(this);var d=e.data();e.djangoInline(d.options||d)})})})(window.django?window.django.jQuery:jQuery);