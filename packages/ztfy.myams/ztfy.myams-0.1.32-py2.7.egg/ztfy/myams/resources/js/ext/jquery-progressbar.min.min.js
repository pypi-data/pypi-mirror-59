!function(e){e.extend({progressBar:new function(){this.defaults={steps:20,step_duration:20,max:100,showText:!0,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"/--static--/ztfy.jqueryui/img/progressbar.gif",barImage:{0:"/--static--/ztfy.jqueryui/img/progressbg_red.gif",30:"/--static--/ztfy.jqueryui/img/progressbg_orange.gif",70:"/--static--/ztfy.jqueryui/img/progressbg_green.gif"},running_value:0,value:0,image:null},this.construct=function(n,t){var r=null,a=null;return null!=n&&(isNaN(n)?a=n:(r=n,null!=t&&(a=t))),this.each(function(n){function t(e){return 100*e.running_value/e.max}function i(e){var n=e.barImage;if("object"==typeof e.barImage)for(var r in e.barImage){if(!(t(e)>=parseInt(r)))break;n=e.barImage[r]}return n}function u(e){if(e.showText){if("percentage"==e.textFormat)return" "+Math.round(e.running_value)+"%";if("fraction"==e.textFormat)return" "+e.running_value+"/"+e.max}}var l=this,g=this.config;if(null!=r&&null!=this.bar&&null!=this.config)this.config.value=r,null!=a&&(l.config=e.extend(this.config,a)),g=l.config;else{var s=e(this);(g=e.extend({},e.progressBar.defaults,a)).id=s.attr("id")?s.attr("id"):Math.ceil(1e5*Math.random()),null==r&&(r=s.html().replace("%","")),g.value=r,g.running_value=0,g.image=i(g),s.html("");var c=document.createElement("img"),o=document.createElement("span"),m=e(c),d=e(o);l.bar=m,m.attr("id",g.id+"_pbImage"),d.attr("id",g.id+"_pbText"),d.html(u(g)),m.attr("title",u(g)),m.attr("alt",u(g)),m.attr("src",g.boxImage),m.attr("width",g.width),m.css("width",g.width+"px"),m.css("height",g.height+"px"),m.css("background-image","url("+g.image+")"),m.css("background-position",-1*g.width+"px 50%"),m.css("padding","0"),m.css("margin","0"),s.append(m),s.append(d)}g.increment=Math.round((g.value-g.running_value)/g.steps),g.increment<0&&(g.increment*=-1),g.increment<1&&(g.increment=1);var f=setInterval(function(){var n=g.width/100;g.running_value>g.value?g.running_value-g.increment<g.value?g.running_value=g.value:g.running_value-=g.increment:g.running_value<g.value&&(g.running_value+g.increment>g.value?g.running_value=g.value:g.running_value+=g.increment),g.running_value==g.value&&clearInterval(f);var r=e("#"+g.id+"_pbImage"),a=e("#"+g.id+"_pbText"),s=i(g);s!=g.image&&(r.css("background-image","url("+s+")"),g.image=s),r.css("background-position",-1*g.width+t(g)*n+"px 50%"),r.attr("title",u(g)),a.html(u(g)),null!=g.callback&&"function"==typeof g.callback&&g.callback(g),l.config=g},g.step_duration)})},this.submit=function(n){if(e("input:file",n).length>0){var t=e("iframe[name=progress]",n);if(t.length>0){for(var r="",a=0;a<32;a++)r+=Math.floor(16*Math.random()).toString(16);var i=e(n).attr("action");i=(old_id=/X-Progress-ID=([^&]+)/.exec(i))?i.replace(old_id[1],r):i+"?X-Progress-ID="+r,e(n).attr("action",i);var u=e(t).get(0).contentWindow.updateUploadProgress;if(u)return u(r),r}}}}}),e.fn.extend({progressBar:e.progressBar.construct})}(jQuery);
