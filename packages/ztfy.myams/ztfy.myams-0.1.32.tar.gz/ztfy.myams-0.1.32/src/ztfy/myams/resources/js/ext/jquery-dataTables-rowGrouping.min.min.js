!function(r){r.fn.rowGrouping=function(e){function n(r){return["January","February","March","April","May","June","July","August","September","October","November","December"][r-1]}var o={iGroupingColumnIndex:0,sGroupingColumnSortDirection:"",iGroupingOrderByColumnIndex:-1,sGroupingClass:"group",sGroupItemClass:"group-item",bHideGroupingColumn:!0,bHideGroupingOrderByColumn:!0,sGroupBy:"name",sGroupLabelPrefix:"",fnGroupLabelFormat:function(r){return r},bExpandableGrouping:!1,bExpandSingleGroup:!1,iExpandGroupOffset:100,asExpandedGroups:null,sDateFormat:"dd/MM/yyyy",sEmptyGroupLabel:"-",bSetGroupingClassOnTR:!1,iGroupingColumnIndex2:-1,sGroupingColumnSortDirection2:"",iGroupingOrderByColumnIndex2:-1,sGroupingClass2:"subgroup",sGroupItemClass2:"subgroup-item",bHideGroupingColumn2:!0,bHideGroupingOrderByColumn2:!0,sGroupBy2:"name",sGroupLabelPrefix2:"",fnGroupLabelFormat2:function(r){return r},bExpandableGrouping2:!1,fnOnGrouped:function(){},fnOnGroupCreated:function(r,e,n){},fnOnGroupCompleted:function(r,e,n){},oHideEffect:null,oShowEffect:null,bUseFilteringForGrouping:!1};return this.each(function(a,u){function t(e,n,o){var a=document.createElement("tr"),u=document.createElement("td");a.id="group-id-"+C.attr("id")+"_"+e;var t={id:a.id,key:e,text:n,level:0,groupItemClass:".group-item-"+e,dataGroup:e,aoSubgroups:new Array};return O.bSetGroupingClassOnTR?a.className=O.sGroupingClass+" "+e:u.className=O.sGroupingClass+" "+e,u.colSpan=o,u.innerHTML=O.sGroupLabelPrefix+O.fnGroupLabelFormat(""==n?O.sEmptyGroupLabel:n,t),O.bExpandableGrouping&&(s(e)?(u.className+=" collapsed-group",t.state="collapsed"):(u.className+=" expanded-group",t.state="expanded"),u.className+=" group-item-expander",r(u).attr("data-group",t.dataGroup),r(u).attr("data-group-level",t.level),r(u).click(m)),a.appendChild(u),c[e]=t,t.nGroup=a,O.fnOnGroupCreated(t,e,1),t}function i(e,n,o,a){var u=document.createElement("tr");u.id=a.id+"_"+e;var t=document.createElement("td"),i=a.dataGroup+"_"+e,p={id:u.id,key:e,text:n,level:a.level+1,groupItemClass:".group-item-"+i,dataGroup:i,aoSubgroups:new Array};return O.bSetGroupingClassOnTR?u.className=O.sGroupingClass2+" "+e:t.className=O.sGroupingClass2+" "+e,t.colSpan=o,t.innerHTML=O.sGroupLabelPrefix2+O.fnGroupLabelFormat2(""==n?O.sEmptyGroupLabel:n,p),O.bExpandableGrouping&&(u.className+=" group-item-"+a.dataGroup),O.bExpandableGrouping&&O.bExpandableGrouping2&&(s(p.dataGroup)?(t.className+=" collapsed-group",p.state="collapsed"):(t.className+=" expanded-group",p.state="expanded"),t.className+=" group-item-expander",r(t).attr("data-group",p.dataGroup),r(t).attr("data-group-level",p.level),r(t).click(m)),u.appendChild(t),a.aoSubgroups[p.dataGroup]=p,c[p.dataGroup]=p,p.nGroup=u,O.fnOnGroupCreated(p,e,2),p}function s(e){return null!=c[e]?"collapsed"==c[e].state:e.indexOf("_")>-1?void 0:(!E||null!=y&&0!=y.length)&&-1==r.inArray(e,y)}function p(r){return r.length<x+b?r:r.substr(x,b)}function d(r){return r}function l(r){return r.substr(0,1)}function g(r){return""===r?"-":r.toLowerCase().replace(/[^a-zA-Z0-9\u0080-\uFFFF]+/g,"-")}function G(e){c[e].state="expanded",r("td[data-group^='"+e+"']").removeClass("collapsed-group"),r("td[data-group^='"+e+"']").addClass("expanded-group"),O.bUseFilteringForGrouping?C.fnDraw():(-1==jQuery.inArray(e,y)&&y.push(e),null!=O.oHideEffect?r(".group-item-"+e,C)[O.oShowEffect.method](O.oShowEffect.duration,O.oShowEffect.easing,function(){}):r(".group-item-"+e,C).show())}function f(e){c[e].state="collapsed",r("td[data-group^='"+e+"']").removeClass("expanded-group"),r("td[data-group^='"+e+"']").addClass("collapsed-group"),O.bUseFilteringForGrouping?C.fnDraw():(r(".group-item-"+e).each(function(){C.fnIsOpen(this)&&(null!=O.fnOnRowClosed&&O.fnOnRowClosed(this),C.fnClose(this))}),null!=O.oHideEffect?r(".group-item-"+e,C)[O.oHideEffect.method](O.oHideEffect.duration,O.oHideEffect.easing,function(){}):r(".group-item-"+e,C).hide())}function m(e){var n=r(this).attr("data-group"),o=(r(this).attr("data-group-level"),!s(n));if(O.bExpandSingleGroup){if(!o)if(f(r("td.expanded-group").attr("data-group")),G(n),-1!=O.iExpandGroupOffset){a=r("#group-id-"+C.attr("id")+"_"+n).offset().top-O.iExpandGroupOffset;window.scroll(0,a)}else{var a=C.offset().top;window.scroll(0,a)}}else o?f(n):G(n);e.preventDefault()}var C=r(u).dataTable(),c=new Array;r(this).dataTableExt.aoGroups=c;var x=6,b=4,y=new Array,E=!0,O=r.extend(o,e);-1==O.iGroupingOrderByColumnIndex?(O.bCustomColumnOrdering=!1,O.iGroupingOrderByColumnIndex=O.iGroupingColumnIndex):O.bCustomColumnOrdering=!0,""==O.sGroupingColumnSortDirection&&("year"==O.sGroupBy?O.sGroupingColumnSortDirection="desc":O.sGroupingColumnSortDirection="asc"),-1==O.iGroupingOrderByColumnIndex2?(O.bCustomColumnOrdering2=!1,O.iGroupingOrderByColumnIndex2=O.iGroupingColumnIndex2):O.bCustomColumnOrdering2=!0,""==O.sGroupingColumnSortDirection2&&("year"==O.sGroupBy2?O.sGroupingColumnSortDirection2="desc":O.sGroupingColumnSortDirection2="asc"),x=O.sDateFormat.toLowerCase().indexOf("yy"),b=O.sDateFormat.toLowerCase().lastIndexOf("y")-O.sDateFormat.toLowerCase().indexOf("y")+1;var S=O.sDateFormat.toLowerCase().indexOf("mm"),h=O.sDateFormat.toLowerCase().lastIndexOf("m")-O.sDateFormat.toLowerCase().indexOf("m")+1,v=d;switch(O.sGroupBy){case"letter":v=l;break;case"year":v=function(r){return p(r)};break;case"month":v=function(r){return r.substr(x,b)+" "+n(r.substr(S,h))};break;default:v=d}if(null!=O.asExpandedGroups){if("NONE"==O.asExpandedGroups)O.asExpandedGroups=[],y=O.asExpandedGroups,E=!1;else if("ALL"==O.asExpandedGroups)O.bAddAllGroupsAsExpanded=!0;else if(O.asExpandedGroups.constructor==String){var D=O.asExpandedGroups;O.asExpandedGroups=new Array,O.asExpandedGroups.push(g(D)),y=O.asExpandedGroups,E=!1}else if(O.asExpandedGroups.constructor==Array){for(var I=0;I<O.asExpandedGroups.length&&(y.push(g(O.asExpandedGroups[I])),!O.bExpandSingleGroup);I++);E=!1}}else O.asExpandedGroups=new Array,O.bAddAllGroupsAsExpanded=!0;if(O.bExpandSingleGroup){var w=r("tbody tr",C),F=C.fnGetData(w[0],O.iGroupingColumnIndex),A=F;"year"!=O.sGroupBy&&(A=v(F));var B=g(A);O.asExpandedGroups=new Array,O.asExpandedGroups.push(B)}C.fnSetColumnVis(O.iGroupingColumnIndex,!O.bHideGroupingColumn),O.bCustomColumnOrdering&&C.fnSetColumnVis(O.iGroupingOrderByColumnIndex,!O.bHideGroupingOrderByColumn),-1!=O.iGroupingColumnIndex2&&C.fnSetColumnVis(O.iGroupingColumnIndex2,!O.bHideGroupingColumn2),O.bCustomColumnOrdering2&&C.fnSetColumnVis(O.iGroupingOrderByColumnIndex2,!O.bHideGroupingOrderByColumn2),C.fnSettings().aoDrawCallback.push({fn:function(e){C.fnSettings().oFeatures.bServerSide&&(E=!0);var n=!1;if(-1!=O.iGroupingColumnIndex2&&(n=!0),0!=e.aiDisplayMaster.length){for(var o=r("tbody tr",C),a=0,u=0;u<e.aoColumns.length;u++)e.aoColumns[u].bVisible&&(a+=1);var p=null,d=null;if(e.aiDisplay.length>0)for(var l=0;l<o.length;l++){var G=e._iDisplayStart+l;C.fnSettings().oFeatures.bServerSide&&(G=l);var f="",m=null,x="",b=null,m=f=this.fnGetData(o[l],O.iGroupingColumnIndex);if("year"!=O.sGroupBy&&(m=v(f)),n&&(void 0==(x=e.aoData[e.aiDisplay[G]]._aData[O.iGroupingColumnIndex2])&&(x=e.aoData[e.aiDisplay[G]]._aData[e.aoColumns[O.iGroupingColumnIndex2].mDataProp]),"year"!=O.sGroupBy2&&(b=v(x))),null==p||g(m)!=g(p)){var S=g(m);null!=p&&O.fnOnGroupCompleted(c[g(p)]),O.bAddAllGroupsAsExpanded&&-1==jQuery.inArray(S,y)&&y.push(S);var h=t(S,m,a).nGroup;null!=o[l].parentNode?o[l].parentNode.insertBefore(h,o[l]):r(o[l]).before(h),p=m,d=null}if(r(o[l]).attr("data-group",c[S].dataGroup),r(o[l]).addClass(O.sGroupItemClass),r(o[l]).addClass("group-item-"+S),O.bExpandableGrouping&&s(S)&&!O.bUseFilteringForGrouping&&r(o[l]).hide(),n){if(null==d||g(b)!=g(d)){var D=i(g(m)+"-"+g(b),b,a,c[S]),I=D.nGroup;o[l].parentNode.insertBefore(I,o[l]),d=b}r(o[l]).attr("data-group",D.dataGroup).addClass(O.sGroupItemClass2).addClass("group-item-"+D.dataGroup)}}null!=p&&O.fnOnGroupCompleted(c[g(p)]),O.fnOnGrouped(c),E=!1}},sName:"fnRowGrouping"});var L=new Array;switch(L.push([O.iGroupingOrderByColumnIndex,O.sGroupingColumnSortDirection]),-1!=O.iGroupingColumnIndex2&&L.push([O.iGroupingOrderByColumnIndex2,O.sGroupingColumnSortDirection2]),C.fnSettings().aaSortingFixed=L,O.sGroupBy){case"name":break;case"letter":C.fnSettings().aoColumns[O.iGroupingOrderByColumnIndex].sSortDataType="rg-letter",r.fn.dataTableExt.afnSortData["rg-letter"]=function(e,n){var o=[];return r("td:eq("+n+")",e.oApi._fnGetTrNodes(e)).each(function(){o.push(l(this.innerHTML))}),o};break;case"year":C.fnSettings().aoColumns[O.iGroupingOrderByColumnIndex].sSortDataType="rg-date",r.fn.dataTableExt.afnSortData["rg-date"]=function(r,e){var n=[],o=r.oApi._fnGetTrNodes(r);for(I=0;I<o.length;I++)n.push(p(C.fnGetData(o[I],e)));return n}}O.bUseFilteringForGrouping&&r.fn.dataTableExt.afnFiltering.push(function(r,e,n){if(r.nTable.id!==C[0].id)return!0;var o=e[O.iGroupingColumnIndex];return void 0===o&&(o=e[r.aoColumns[O.iGroupingColumnIndex].mDataProp]),!s(g(o))||(C.fnIsOpen(C.fnGetNodes(n))&&(null!=O.fnOnRowClosed&&O.fnOnRowClosed(this),C.fnClose(C.fnGetNodes(n))),!1)}),C.fnDraw()})}}(jQuery);
