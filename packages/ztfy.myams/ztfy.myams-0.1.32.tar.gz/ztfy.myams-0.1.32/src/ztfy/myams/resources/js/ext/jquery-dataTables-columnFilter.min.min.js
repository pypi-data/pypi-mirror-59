!function(e){e.fn.columnFilter=function(t){function n(e,t,n,a,r){if(void 0===t)return new Array;void 0===n&&(n=!0),void 0===a&&(a=!0),void 0===r&&(r=!0);var i;i=1==a?e.aiDisplay:e.aiDisplayMaster;for(var l=new Array,s=0,o=i.length;s<o;s++){var c=i[s],u=_.fnGetData(c)[t];1==r&&0==u.length||(1==n&&jQuery.inArray(u,l)>-1||l.push(u))}return l.sort()}function a(e){return x.bUseColVis?e:_.fnSettings().oApi._fnVisibleToColumnIndex(_.fnSettings(),e)}function r(t,n,r,i,l,s){var o="text_filter";i&&(o="number_filter"),p=p.replace(/(^\s*)|(\s*$)/g,"");var c=t.fnSettings().aoPreSearchCols[h].sSearch,u="search_init ",f=p;""!=c&&"^"!=c&&(f=i&&"^"==c.charAt(0)?c.substr(1):c,u="");var v=e('<input type="text" class="'+u+o+'" value="'+f+'" rel="'+h+'"/>');void 0!=s&&-1!=s&&v.attr("maxlength",s),g.html(v),i?g.wrapInner('<span class="filter_column filter_number" />'):g.wrapInner('<span class="filter_column filter_text" />'),d[h]=p;var m=h;i&&!t.fnSettings().oFeatures.bServerSide?v.keyup(function(){t.fnFilter("^"+this.value,a(m),!0,!1),S()}):v.keyup(function(){if(t.fnSettings().oFeatures.bServerSide&&0!=l){t.fnSettings().aoPreSearchCols[m].sSearch;var i=e(this).data("dt-iLastFilterLength");void 0===i&&(i=0);var s=this.value.length;if(Math.abs(s-i)<l)return;e(this).data("dt-iLastFilterLength",s)}t.fnFilter(this.value,a(m),n,r),S()}),v.focus(function(){e(this).hasClass("search_init")&&(e(this).removeClass("search_init"),this.value="")}),v.blur(function(){""==this.value&&(e(this).addClass("search_init"),this.value=d[m])})}function i(t){g.html(f(0));var n=t.attr("id")+"_range_from_"+h,r=e('<input type="text" class="number_range_filter" id="'+n+'" rel="'+h+'"/>');g.append(r),g.append(f(1));var i=t.attr("id")+"_range_to_"+h,l=e('<input type="text" class="number_range_filter" id="'+i+'" rel="'+h+'"/>');g.append(l),g.append(f(2)),g.wrapInner('<span class="filter_column filter_number_range" />');var s=h;b.push(h),t.dataTableExt.afnFiltering.push(function(e,r,l){if(t.attr("id")!=e.sTableId)return!0;if(null==document.getElementById(n))return!0;var o=1*document.getElementById(n).value,c=1*document.getElementById(i).value,u="-"==r[a(s)]?0:1*r[a(s)];return""==o&&""==c||(""==o&&u<=c||(o<=u&&""==c||o<=u&&u<=c))}),e("#"+n+",#"+i,g).keyup(function(){var e=1*document.getElementById(n).value,a=1*document.getElementById(i).value;0!=e&&0!=a&&e>a||(t.fnDraw(),S())})}function l(t){var n=v.split(/[}{]/);g.html("");var r=t.attr("id")+"_range_from_"+h,i=e('<input type="text" class="date_range_filter" id="'+r+'" rel="'+h+'"/>');i.datepicker();var l=t.attr("id")+"_range_to_"+h,s=e('<input type="text" class="date_range_filter" id="'+l+'" rel="'+h+'"/>');for(ti=0;ti<n.length;ti++)n[ti]==x.sDateFromToken?g.append(i):n[ti]==x.sDateToToken?g.append(s):g.append(n[ti]);g.wrapInner('<span class="filter_column filter_date_range" />'),s.datepicker();var o=h;b.push(h),t.dataTableExt.afnFiltering.push(function(n,r,l){if(t.attr("id")!=n.sTableId)return!0;var c=i.datepicker("getDate"),u=s.datepicker("getDate");if(null==c&&null==u)return!0;var f=null;try{if(null==r[a(o)]||""==r[a(o)])return!1;f=e.datepicker.parseDate(e.datepicker.regional[""].dateFormat,r[a(o)])}catch(e){return!1}return null!=f&&(null==c&&f<=u||(c<=f&&null==u||c<=f&&f<=u))}),e("#"+r+",#"+l,g).change(function(){t.fnDraw(),S()})}function s(t,a,r,i,l,s,o){null==a&&(a=n(t.fnSettings(),r,!0,!1,!0));var c=t.fnSettings().aoPreSearchCols[h].sSearch;null!=c&&""!=c||(c=o);var u='<select class="search_init select_filter" rel="'+h+'"><option value="" class="search_init">'+l+"</option>",f=0,d=a.length;for(f=0;f<d;f++)if("object"!=typeof a[f]){p="";escape(a[f])!=c&&escape(a[f])!=escape(c)||(p="selected "),u+="<option "+p+' value="'+escape(a[f])+'">'+a[f]+"</option>"}else{var p="";s?(a[f].value==c&&(p="selected "),u+="<option "+p+'value="'+a[f].value+'">'+a[f].label+"</option>"):(escape(a[f].value)==c&&(p="selected "),u+="<option "+p+'value="'+escape(a[f].value)+'">'+a[f].label+"</option>")}var g=e(u+"</select>");i.html(g),i.wrapInner('<span class="filter_column filter_select" />'),g.change(function(){""!=e(this).val()?e(this).removeClass("search_init"):e(this).addClass("search_init"),s?t.fnFilter(e(this).val(),r,s):t.fnFilter(unescape(e(this).val()),r),S()}),null!=c&&""!=c&&t.fnFilter(unescape(c),r)}function o(e,t,n,r){var i=e.fnSettings();null!=t||""==i.sAjaxSource||i.oFeatures.bServerSide||i.aoDrawCallback.push({fn:function(t,l,o){return function(){if(2==i.iDraw&&null!=i.sAjaxSource&&""!=i.sAjaxSource&&!i.oFeatures.bServerSide)return s(e,null,a(t),l,o,n,r)}}(h,g,p),sName:"column_filter_"+h}),s(e,t,a(h),g,p,n,r)}function c(t){var n,a=h,r='<div class="dropdown select_filter"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+p+'<b class="caret"></b></a><ul class="dropdown-menu" role="menu"><li data-value=""><a>Show All</a></li>',i=t.length;for(n=0;n<i;n++)r+='<li data-value="'+t[n]+'"><a>'+t[n]+"</a></li>";var l=e(r+"</ul></div>");g.html(l),g.wrapInner('<span class="filterColumn filter_select" />'),l.find("li").click(function(){_.fnFilter(e(this).data("value"),a)})}function u(t,a){null==a&&(a=n(t.fnSettings(),h,!0,!0,!0));var r,i=h,l="",s=a.length,o=p.replace("%","Perc").replace("&","AND").replace("$","DOL").replace("Â£","STERL").replace("@","AT").replace(/\s/g,"_");o=o.replace(/[^a-zA-Z 0-9]+/g,"");var c=p;null==x.sFilterButtonText&&void 0==x.sFilterButtonText||(c=x.sFilterButtonText);var u=Math.floor(s/12);s%12>0&&(u+=1);var f=100/u-2,d=10*u;1==u&&(f=20);var v='<div style="float:left; min-width: '+f+'%; " >',m=t.attr("id")+o,b="chkBtnOpen"+m,_=m+"-flt-toggle";for(l+='<button id="'+b+'" class="checkbox_filter" > '+c+"</button>",l+='<div id="'+_+'" title="'+p+'" rel="'+h+'" class="toggle-check ui-widget-content ui-corner-all"  style="width: '+d+'%; " >',l+=v,r=0;r<s;r++){r%12==0&&0!=r&&(l+="</div>"+v);var k=a[r],F=a[r];"object"==typeof a[r]&&(k=a[r].label,F=a[r].value);var y=e(l+='<input class="search_init checkbox_filter" type="checkbox" id= "'+m+"_cb_"+F+'" name= "'+o+'" value="'+F+'" >'+k+"<br/>");g.html(y),g.wrapInner('<span class="filter_column filter_checkbox" />'),y.change(function(){var n="",a="|",r=e('input:checkbox[name="'+o+'"]:checked').size();e('input:checkbox[name="'+o+'"]:checked').each(function(t){(0==t&&1==r||0!=t&&t==r-1)&&(a=""),n=n.replace(/^\s+|\s+$/g,""),n=n+e(this).val()+a,a="|"}),""!=n?e('input:checkbox[name="'+o+'"]').removeClass("search_init"):e('input:checkbox[name="'+o+'"]').addClass("search_init"),t.fnFilter(n,i,!0,!1),S()})}e("#"+b).button(),e("#"+_).dialog({autoOpen:!1,hide:"blind",buttons:[{text:"Reset",click:function(){return e('input:checkbox[name="'+o+'"]:checked').each(function(t){e(this).attr("checked",!1),e(this).addClass("search_init")}),t.fnFilter("",i,!0,!1),S(),!1}},{text:"Close",click:function(){e(this).dialog("close")}}]}),e("#"+b).click(function(){e("#"+_).dialog("open");var t=e(this);return e("#"+_).dialog("widget").position({my:"top",at:"bottom",of:t}),!1});var w=S;S=function(){var t=e("#"+b);e("#"+_).dialog("widget").position({my:"top",at:"bottom",of:t}),w()}}function f(e){switch(e){case 0:return v.substring(0,v.indexOf("{from}"));case 1:return v.substring(v.indexOf("{from}")+6,v.indexOf("{to}"));default:return v.substring(v.indexOf("{to}")+4)}}var d,h,p,g,v="From {from} to {to}",m=new Array,b=new Array,S=function(){},_=this,x=e.extend({sPlaceHolder:"foot",sRangeSeparator:"~",iFilteringDelay:500,aoColumns:null,sRangeFormat:"From {from} to {to}",sDateFromToken:"from",sDateToToken:"to"},t);return this.each(function(){if(_.fnSettings().oFeatures.bFilter){d=new Array;var t=_.fnSettings().aoFooter[0];_.fnSettings().nTFoot;if("head:after"==x.sPlaceHolder){var n=e("tr:first",_.fnSettings().nTHead).detach();_.fnSettings().bSortCellsTop?(n.prependTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[1]):(n.appendTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[0]),"tr:last",_.fnSettings().nTHead}else"head:before"==x.sPlaceHolder&&(_.fnSettings().bSortCellsTop?((n=e("tr:first",_.fnSettings().nTHead).detach()).appendTo(e(_.fnSettings().nTHead)),t=_.fnSettings().aoHeader[1]):t=_.fnSettings().aoHeader[0],"tr:first",_.fnSettings().nTHead);for(e(t).each(function(t){h=t;var n={type:"text",bRegex:!1,bSmart:!0,iMaxLenght:-1,iFilterLength:0};if(null!=x.aoColumns){if(x.aoColumns.length<h||null==x.aoColumns[h])return;n=x.aoColumns[h]}if(p=e(e(this)[0].cell).text(),null==n.sSelector?g=e(e(this)[0].cell):0==(g=e(n.sSelector)).length&&(g=e(e(this)[0].cell)),null!=n)switch(v=null!=n.sRangeFormat?n.sRangeFormat:x.sRangeFormat,n.type){case"null":break;case"number":r(_,!0,!1,!0,n.iFilterLength,n.iMaxLenght);break;case"select":1!=n.bRegex&&(n.bRegex=!1),o(_,n.values,n.bRegex,n.selected);break;case"number-range":i(_);break;case"date-range":l(_);break;case"checkbox":u(_,n.values);break;case"twitter-dropdown":case"dropdown":c(n.values);break;case"text":default:bRegex=null!=n.bRegex&&n.bRegex,bSmart=null!=n.bSmart&&n.bSmart,r(_,bRegex,bSmart,!1,n.iFilterLength,n.iMaxLenght)}}),j=0;j<b.length;j++){m.push(function(){var t=_.attr("id");return e("#"+t+"_range_from_"+b[j]).val()+x.sRangeSeparator+e("#"+t+"_range_to_"+b[j]).val()})}if(_.fnSettings().oFeatures.bServerSide){var a=_.fnSettings().fnServerData;_.fnSettings().fnServerData=function(t,n,r){for(j=0;j<b.length;j++){var i=b[j];for(k=0;k<n.length;k++)n[k].name=="sSearch_"+i&&(n[k].value=m[j]())}if(n.push({name:"sRangeSeparator",value:x.sRangeSeparator}),null!=a)try{a(t,n,r,_.fnSettings())}catch(e){a(t,n,r)}else e.getJSON(t,n,function(e){r(e)})}}}})}}(jQuery);
