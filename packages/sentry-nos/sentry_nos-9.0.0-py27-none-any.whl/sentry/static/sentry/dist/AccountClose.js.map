{"version":3,"sources":["webpack:///68.js","webpack:///./app/views/settings/account/accountClose.jsx"],"names":["webpackJsonpexports","1585","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","defineProperty","__WEBPACK_IMPORTED_MODULE_0_prop_types__","__WEBPACK_IMPORTED_MODULE_0_prop_types___default","n","__WEBPACK_IMPORTED_MODULE_1_react__","__WEBPACK_IMPORTED_MODULE_1_react___default","__WEBPACK_IMPORTED_MODULE_2_react_emotion__","__WEBPACK_IMPORTED_MODULE_3_app_actionCreators_indicator__","__WEBPACK_IMPORTED_MODULE_4_app_actionCreators_modal__","__WEBPACK_IMPORTED_MODULE_5_app_locale__","__WEBPACK_IMPORTED_MODULE_6_app_views_asyncView__","__WEBPACK_IMPORTED_MODULE_7_app_components_buttons_button__","__WEBPACK_IMPORTED_MODULE_8_app_components_confirm__","__WEBPACK_IMPORTED_MODULE_9_app_views_settings_components_settingsPageHeader__","__WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__","_createClass","defineProperties","target","props","i","length","descriptor","key","protoProps","staticProps","leaveRedirect","window","location","href","Important","GoodbyeModalContent","_ref","Header","Body","Footer","a","createElement","propTypes","node","AccountClose","_AsyncView","_ref2","this","_len","arguments","args","Array","_key","_this","getPrototypeOf","apply","concat","getSingleOwners","state","organizations","filter","_ref3","singleOwner","map","_ref4","organization","slug","handleChange","_ref5","isSingle","event","checked","setState","set","orgsToRemove","Set","add","delete","handleRemoveAccount","orgs","from","api","requestPromise","method","data","then","onClose","setTimeout","_this2","_state","title","_ref6","style","marginRight","type","onChange","bind","name","has","disabled","priority","message","onConfirm"],"mappings":"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","file":"68.js","sourcesContent":["webpackJsonpexports([68],{\n\n/***/ 1585:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_prop_types__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_prop_types___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_prop_types__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_react__ = __webpack_require__(0);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_react___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_react__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_react_emotion__ = __webpack_require__(5);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_app_actionCreators_indicator__ = __webpack_require__(80);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_app_actionCreators_modal__ = __webpack_require__(104);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_app_locale__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_app_views_asyncView__ = __webpack_require__(92);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_app_components_buttons_button__ = __webpack_require__(26);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_app_components_confirm__ = __webpack_require__(119);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_app_views_settings_components_settingsPageHeader__ = __webpack_require__(52);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__ = __webpack_require__(81);\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar BYE_URL = '/';\nvar leaveRedirect = function leaveRedirect() {\n  return window.location.href = BYE_URL;\n};\n\nvar Important = /*#__PURE__*/Object(__WEBPACK_IMPORTED_MODULE_2_react_emotion__[\"default\"])('div', {\n  target: 'e1prmbzz0'\n})('font-weight:bold;font-size:1.2em;');\n\nvar GoodbyeModalContent = function GoodbyeModalContent(_ref) {\n  var Header = _ref.Header,\n      Body = _ref.Body,\n      Footer = _ref.Footer;\n  return __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n    'div',\n    null,\n    __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n      Header,\n      null,\n      Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Closing Account')\n    ),\n    __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n      Body,\n      null,\n      __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n        __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n        null,\n        Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Your account has been deactivated and scheduled for removal.')\n      ),\n      __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n        __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n        null,\n        Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Thanks for using Sentry! We hope to see you again soon!')\n      )\n    ),\n    __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n      Footer,\n      null,\n      __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n        __WEBPACK_IMPORTED_MODULE_7_app_components_buttons_button__[\"default\"],\n        { href: BYE_URL },\n        Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Goodbye')\n      )\n    )\n  );\n};\n\nGoodbyeModalContent.propTypes = {\n  Header: __WEBPACK_IMPORTED_MODULE_0_prop_types___default.a.node,\n  Body: __WEBPACK_IMPORTED_MODULE_0_prop_types___default.a.node,\n  Footer: __WEBPACK_IMPORTED_MODULE_0_prop_types___default.a.node\n};\n\nvar AccountClose = function (_AsyncView) {\n  _inherits(AccountClose, _AsyncView);\n\n  _createClass(AccountClose, [{\n    key: 'getEndpoints',\n    value: function getEndpoints() {\n      return [['organizations', '/organizations/?owner=1']];\n    }\n  }]);\n\n  function AccountClose() {\n    var _ref2;\n\n    _classCallCheck(this, AccountClose);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var _this = _possibleConstructorReturn(this, (_ref2 = AccountClose.__proto__ || Object.getPrototypeOf(AccountClose)).call.apply(_ref2, [this].concat(args)));\n\n    _this.getSingleOwners = function () {\n      return _this.state.organizations.filter(function (_ref3) {\n        var singleOwner = _ref3.singleOwner;\n        return singleOwner;\n      }).map(function (_ref4) {\n        var organization = _ref4.organization;\n        return organization.slug;\n      });\n    };\n\n    _this.handleChange = function (_ref5, isSingle, event) {\n      var slug = _ref5.slug;\n\n      var checked = event.target.checked;\n\n      // Can't unselect an org where you are the single owner\n      if (isSingle) return;\n\n      _this.setState(function (state) {\n        var set = state.orgsToRemove || new Set(_this.getSingleOwners());\n        if (checked) {\n          set.add(slug);\n        } else {\n          set.delete(slug);\n        }\n\n        return {\n          orgsToRemove: set\n        };\n      });\n    };\n\n    _this.handleRemoveAccount = function () {\n      var orgsToRemove = _this.state.orgsToRemove;\n\n      var orgs = orgsToRemove === null ? _this.getSingleOwners() : Array.from(orgsToRemove);\n\n      Object(__WEBPACK_IMPORTED_MODULE_3_app_actionCreators_indicator__[\"c\" /* addMessage */])('Closing account...');\n\n      _this.api.requestPromise('/users/me/', {\n        method: 'DELETE',\n        data: { organizations: orgs }\n      }).then(function () {\n        Object(__WEBPACK_IMPORTED_MODULE_4_app_actionCreators_modal__[\"f\" /* openModal */])(GoodbyeModalContent, {\n          onClose: leaveRedirect\n        });\n\n        // Redirect after 10 seconds\n        setTimeout(leaveRedirect, 10000);\n      }, function () {\n        Object(__WEBPACK_IMPORTED_MODULE_3_app_actionCreators_indicator__[\"a\" /* addErrorMessage */])('Error closing account');\n      });\n    };\n\n    _this.state.orgsToRemove = null;\n    return _this;\n  }\n\n  // Returns an array of single owners\n\n\n  _createClass(AccountClose, [{\n    key: 'renderBody',\n    value: function renderBody() {\n      var _this2 = this;\n\n      var _state = this.state,\n          organizations = _state.organizations,\n          orgsToRemove = _state.orgsToRemove;\n\n\n      return __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n        'div',\n        null,\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_9_app_views_settings_components_settingsPageHeader__[\"default\"], { title: 'Close Account' }),\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n          null,\n          Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('This will permanently remove all associated data for your user'),\n          '.'\n        ),\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n          null,\n          __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n            Important,\n            null,\n            Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Closing your account is permanent and cannot be undone'),\n            '!'\n          )\n        ),\n        !!organizations.length && __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n          null,\n          Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('If you continue, the following organizations will be removed'),\n          ':'\n        ),\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          'ul',\n          null,\n          organizations.map(function (_ref6) {\n            var organization = _ref6.organization,\n                singleOwner = _ref6.singleOwner;\n\n            return __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n              'li',\n              { key: organization.slug },\n              __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n                'label',\n                null,\n                __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement('input', {\n                  style: { marginRight: 6 },\n                  type: 'checkbox',\n                  value: organization.slug,\n                  onChange: _this2.handleChange.bind(_this2, organization, singleOwner),\n                  name: 'organizations',\n                  checked: orgsToRemove === null ? singleOwner : orgsToRemove.has(organization.slug),\n                  disabled: singleOwner\n                }),\n                organization.name,\n                ' (',\n                organization.slug,\n                ')'\n              )\n            );\n          })\n        ),\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          __WEBPACK_IMPORTED_MODULE_10_app_views_settings_components_text_textBlock__[\"default\"],\n          null,\n          'Ownership will remain with other members if an organization is not deleted.',\n          __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement('br', null),\n          'Disabled boxes mean that there is no other owner within the organization so no one else can take ownership.'\n        ),\n        __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n          __WEBPACK_IMPORTED_MODULE_8_app_components_confirm__[\"a\" /* default */],\n          {\n            priority: 'danger',\n            message: Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('This is permanent and cannot be undone, are you really sure you want to do this?'),\n            onConfirm: this.handleRemoveAccount\n          },\n          __WEBPACK_IMPORTED_MODULE_1_react___default.a.createElement(\n            __WEBPACK_IMPORTED_MODULE_7_app_components_buttons_button__[\"default\"],\n            { priority: 'danger' },\n            Object(__WEBPACK_IMPORTED_MODULE_5_app_locale__[\"t\"])('Close Account')\n          )\n        )\n      );\n    }\n  }]);\n\n  return AccountClose;\n}(__WEBPACK_IMPORTED_MODULE_6_app_views_asyncView__[\"default\"]);\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (AccountClose);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 68.js","import PropTypes from 'prop-types';\nimport React from 'react';\nimport styled from 'react-emotion';\n\nimport {addMessage, addErrorMessage} from 'app/actionCreators/indicator';\nimport {openModal} from 'app/actionCreators/modal';\nimport {t} from 'app/locale';\nimport AsyncView from 'app/views/asyncView';\nimport Button from 'app/components/buttons/button';\nimport Confirm from 'app/components/confirm';\nimport SettingsPageHeader from 'app/views/settings/components/settingsPageHeader';\nimport TextBlock from 'app/views/settings/components/text/textBlock';\n\nconst BYE_URL = '/';\nconst leaveRedirect = () => (window.location.href = BYE_URL);\n\nconst Important = styled.div`\n  font-weight: bold;\n  font-size: 1.2em;\n`;\n\nconst GoodbyeModalContent = ({Header, Body, Footer}) => (\n  <div>\n    <Header>{t('Closing Account')}</Header>\n    <Body>\n      <TextBlock>\n        {t('Your account has been deactivated and scheduled for removal.')}\n      </TextBlock>\n      <TextBlock>\n        {t('Thanks for using Sentry! We hope to see you again soon!')}\n      </TextBlock>\n    </Body>\n    <Footer>\n      <Button href={BYE_URL}>{t('Goodbye')}</Button>\n    </Footer>\n  </div>\n);\n\nGoodbyeModalContent.propTypes = {\n  Header: PropTypes.node,\n  Body: PropTypes.node,\n  Footer: PropTypes.node,\n};\n\nclass AccountClose extends AsyncView {\n  getEndpoints() {\n    return [['organizations', '/organizations/?owner=1']];\n  }\n\n  constructor(...args) {\n    super(...args);\n    this.state.orgsToRemove = null;\n  }\n\n  // Returns an array of single owners\n  getSingleOwners = () => {\n    return this.state.organizations\n      .filter(({singleOwner}) => singleOwner)\n      .map(({organization}) => organization.slug);\n  };\n\n  handleChange = ({slug}, isSingle, event) => {\n    let checked = event.target.checked;\n\n    // Can't unselect an org where you are the single owner\n    if (isSingle) return;\n\n    this.setState(state => {\n      let set = state.orgsToRemove || new Set(this.getSingleOwners());\n      if (checked) {\n        set.add(slug);\n      } else {\n        set.delete(slug);\n      }\n\n      return {\n        orgsToRemove: set,\n      };\n    });\n  };\n\n  handleRemoveAccount = () => {\n    let {orgsToRemove} = this.state;\n    let orgs = orgsToRemove === null ? this.getSingleOwners() : Array.from(orgsToRemove);\n\n    addMessage('Closing account...');\n\n    this.api\n      .requestPromise('/users/me/', {\n        method: 'DELETE',\n        data: {organizations: orgs},\n      })\n      .then(\n        () => {\n          openModal(GoodbyeModalContent, {\n            onClose: leaveRedirect,\n          });\n\n          // Redirect after 10 seconds\n          setTimeout(leaveRedirect, 10000);\n        },\n        () => {\n          addErrorMessage('Error closing account');\n        }\n      );\n  };\n\n  renderBody() {\n    let {organizations, orgsToRemove} = this.state;\n\n    return (\n      <div>\n        <SettingsPageHeader title=\"Close Account\" />\n\n        <TextBlock>\n          {t('This will permanently remove all associated data for your user')}.\n        </TextBlock>\n\n        <TextBlock>\n          <Important>\n            {t('Closing your account is permanent and cannot be undone')}!\n          </Important>\n        </TextBlock>\n\n        {!!organizations.length && (\n          <TextBlock>\n            {t('If you continue, the following organizations will be removed')}:\n          </TextBlock>\n        )}\n\n        <ul>\n          {organizations.map(({organization, singleOwner}) => {\n            return (\n              <li key={organization.slug}>\n                <label>\n                  <input\n                    style={{marginRight: 6}}\n                    type=\"checkbox\"\n                    value={organization.slug}\n                    onChange={this.handleChange.bind(this, organization, singleOwner)}\n                    name=\"organizations\"\n                    checked={\n                      orgsToRemove === null\n                        ? singleOwner\n                        : orgsToRemove.has(organization.slug)\n                    }\n                    disabled={singleOwner}\n                  />\n                  {organization.name} ({organization.slug})\n                </label>\n              </li>\n            );\n          })}\n        </ul>\n\n        <TextBlock>\n          Ownership will remain with other members if an organization is not deleted.<br />\n          Disabled boxes mean that there is no other owner within the organization so no\n          one else can take ownership.\n        </TextBlock>\n\n        <Confirm\n          priority=\"danger\"\n          message={t(\n            'This is permanent and cannot be undone, are you really sure you want to do this?'\n          )}\n          onConfirm={this.handleRemoveAccount}\n        >\n          <Button priority=\"danger\">{t('Close Account')}</Button>\n        </Confirm>\n      </div>\n    );\n  }\n}\n\nexport default AccountClose;\n\n\n\n// WEBPACK FOOTER //\n// ./app/views/settings/account/accountClose.jsx"],"sourceRoot":""}